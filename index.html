<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Portfolio Tracker</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root {
    --bg: #0d1117;
    --text: #e6edf3;
    --card: #161b22;
    --border: #30363d;
    --accent: #58a6ff;
}

body.light {
    --bg: #f4f7fa;
    --text: #333;
    --card: #ffffff;
    --border: #ddd;
    --accent: #1a73e8;
}

body {
    background: var(--bg);
    color: var(--text);
    margin: 0;
    padding: 0;
    font-family: Arial, sans-serif;
    transition: background 0.3s, color 0.3s;
}

header {
    background: var(--accent);
    color: white;
    padding: 20px;
    text-align: center;
    position: relative;
}

#themeToggle {
    position: absolute;
    top: 20px;
    right: 20px;
    padding: 8px 14px;
    background: #ffffff22;
    border: 1px solid #fff5;
    border-radius: 6px;
    color: white;
    cursor: pointer;
}

.container {
    width: 95%;
    max-width: 1100px;
    margin: 20px auto;
    padding: 0 10px;
}

.card {
    background: var(--card);
    color: var(--text);
    border-radius: 8px;
    padding: 20px;
    margin: 20px 0;
    box-shadow: 0 2px 5px rgba(0,0,0,0.15);
    transition: background 0.3s, color 0.3s;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
    color: var(--text);
    display: block;
    overflow-x: auto;
}

th, td {
    padding: 8px;
    border-bottom: 1px solid var(--border);
    white-space: nowrap;
}

h1 { font-size: 1.6em; }
h2 { font-size: 1.2em; }

.footer {
    text-align: center;
    padding: 20px;
    color: var(--text);
    opacity: 0.7;
}

@media (max-width: 600px) {
    body { font-size: 14px; }
    h1 { font-size: 1.4em; }
    h2 { font-size: 1em; }
    #themeToggle { padding: 6px 10px; top: 15px; right: 15px; font-size: 0.9em; }
}
</style>
</head>

<body class="dark">

<header>
    <h1>Portfolio Tracker</h1>
    <p>Auto-Invest ‚Ä¢ Live Prices ‚Ä¢ KPIs</p>
    <button id="themeToggle">‚òÄÔ∏è Light Mode</button>
</header>

<div class="container">

    <div class="card">
        <h2>üìä Total Portfolio KPIs</h2>
        <p><strong>Total Invested:</strong> $<span id="totalInvested">0</span></p>
        <p><strong>Market Value:</strong> $<span id="marketValue">0</span></p>
        <p><strong>Total P/L:</strong> $<span id="totalPL">0</span> (<span id="totalPLPercent">0</span>%)</p>
    </div>

    <div class="card">
        <h2>üí∞ Crypto Holdings</h2>
        <table id="cryptoTable">
            <tr>
                <th>Asset</th>
                <th>Units</th>
                <th>Avg Cost</th>
                <th>Invested</th>
                <th>Price</th>
                <th>Value</th>
                <th>P/L</th>
            </tr>
        </table>
    </div>

    <div class="card">
        <h2>üìà Stock Holdings</h2>
        <table id="stockTable">
            <tr>
                <th>Asset</th>
                <th>Units</th>
                <th>Avg Cost</th>
                <th>Invested</th>
                <th>Price</th>
                <th>Value</th>
                <th>P/L</th>
            </tr>
        </table>
    </div>

</div>

<div class="footer">¬© 2025 Portfolio Tracker</div>

<script>
// CONFIG
const cryptoIDs = {
    BTC: "bitcoin",
    ETH: "ethereum",
    SOL: "solana",
    ADA: "cardano",
    XRP: "ripple",
    AVAX: "avalanche-2"
};

const stockSymbols = ["SPY", "QQQ", "VTI"];
const cryptoMonthly = 100;
const stockMonthly = 100;

const cryptoAlloc = { BTC: 0.70, ETH: 0.20, SOL: 0.025, ADA: 0.025, XRP: 0.025, AVAX: 0.025 };
const stockAlloc = { SPY: 0.333, QQQ: 0.333, VTI: 0.333 };

// STORAGE
let portfolio = JSON.parse(localStorage.getItem("portfolioData")) || {
    crypto: { BTC: { units: 0, invested: 0 }, ETH: { units: 0, invested: 0 }, SOL: { units: 0, invested: 0 }, ADA: { units: 0, invested: 0 }, XRP: { units: 0, invested: 0 }, AVAX: { units: 0, invested: 0 } },
    stocks: { SPY: { units: 0, invested: 0 }, QQQ: { units: 0, invested: 0 }, VTI: { units: 0, invested: 0 } },
    lastInvestmentDate: null
};

function savePortfolio() { localStorage.setItem("portfolioData", JSON.stringify(portfolio)); }

// AUTO-INVEST
async function autoInvest() {
    let today = new Date();
    let todayStr = today.toISOString().split("T")[0];
    if (portfolio.lastInvestmentDate === null || (today.getDate() === 1 && portfolio.lastInvestmentDate !== todayStr)) {
        await runInvestment();
        portfolio.lastInvestmentDate = todayStr;
        savePortfolio();
    }
}

async function runInvestment() {
    const cryptoPrices = await fetchCryptoPrices();
    const stockPrices = await fetchStockPrices();

    for (const sym of Object.keys(cryptoAlloc)) {
        const amount = cryptoMonthly * cryptoAlloc[sym];
        const price = cryptoPrices[sym];
        const units = amount / price;
        portfolio.crypto[sym].units += units;
        portfolio.crypto[sym].invested += amount;
    }

    for (const sym of Object.keys(stockAlloc)) {
        const amount = stockMonthly * stockAlloc[sym];
        const price = stockPrices[sym];
        const units = amount / price;
        portfolio.stocks[sym].units += units;
        portfolio.stocks[sym].invested += amount;
    }
    savePortfolio();
}

// PRICE FETCH
async function fetchCryptoPrices() {
    const ids = Object.values(cryptoIDs).join(",");
    const res = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=usd`);
    const data = await res.json();
    let prices = {};
    for (const sym of Object.keys(cryptoIDs)) prices[sym] = data[cryptoIDs[sym]].usd;
    return prices;
}

async function fetchStockPrices() {
    const symbols = ["SPY", "QQQ", "VTI"];
    let prices = {};

    for (const sym of symbols) {
        try {
            const res = await fetch(`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${sym}&apikey=TM5H6I43G6RCU0IB`);
            const data = await res.json();
            prices[sym] = parseFloat(data["Global Quote"]["05. price"]);
        } catch (err) {
            console.error(`Error fetching ${sym}:`, err);
            prices[sym] = 0;
        }
    }

    return prices;
}


// UPDATE UI
async function updateUI() {
    const cryptoPrices = await fetchCryptoPrices();
    const stockPrices = await fetchStockPrices();

    updateCryptoTable(cryptoPrices);
    updateStockTable(stockPrices);
    updatePortfolioKPIs(cryptoPrices, stockPrices);
}

function updateCryptoTable(prices) {
    const table = document.getElementById("cryptoTable");
    table.querySelectorAll("tr:not(:first-child)").forEach(e => e.remove());
    for (const sym of Object.keys(portfolio.crypto)) {
        const c = portfolio.crypto[sym];
        if (c.units === 0) continue;
        const value = c.units * prices[sym];
        const avg = c.invested / c.units;
        const pl = value - c.invested;
        table.innerHTML += `<tr>
            <td>${sym}</td>
            <td>${c.units.toFixed(6)}</td>
            <td>$${avg.toFixed(2)}</td>
            <td>$${c.invested.toFixed(2)}</td>
            <td>$${prices[sym].toFixed(2)}</td>
            <td>$${value.toFixed(2)}</td>
            <td style="color:${pl>=0?"lightgreen":"red"}">$${pl.toFixed(2)}</td>
        </tr>`;
    }
}

function updateStockTable(prices) {
    const table = document.getElementById("stockTable");
    table.querySelectorAll("tr:not(:first-child)").forEach(e => e.remove());
    for (const sym of stockSymbols) {
        const s = portfolio.stocks[sym];
        if (s.units === 0) continue;
        const value = s.units * prices[sym];
        const avg = s.invested / s.units;
        const pl = value - s.invested;
        table.innerHTML += `<tr>
            <td>${sym}</td>
            <td>${s.units.toFixed(6)}</td>
            <td>$${avg.toFixed(2)}</td>
            <td>$${s.invested.toFixed(2)}</td>
            <td>$${prices[sym].toFixed(2)}</td>
            <td>$${value.toFixed(2)}</td>
            <td style="color:${pl>=0?"lightgreen":"red"}">$${pl.toFixed(2)}</td>
        </tr>`;
    }
}

function updatePortfolioKPIs(cryptoPrices, stockPrices) {
    let invested = 0, value = 0;
    for (const sym of Object.keys(portfolio.crypto)) {
        invested += portfolio.crypto[sym].invested;
        value += portfolio.crypto[sym].units * cryptoPrices[sym];
    }
    for (const sym of stockSymbols) {
        invested += portfolio.stocks[sym].invested;
        value += portfolio.stocks[sym].units * stockPrices[sym];
    }
    const pl = value - invested;
    document.getElementById("totalInvested").innerText = invested.toFixed(2);
    document.getElementById("marketValue").innerText = value.toFixed(2);
    document.getElementById("totalPL").innerText = pl.toFixed(2);
    document.getElementById("totalPLPercent").innerText = ((pl/invested)*100).toFixed(2);
}

// DARK MODE
const themeToggle = document.getElementById("themeToggle");
themeToggle.addEventListener("click", () => {
    document.body.classList.toggle("light");
    themeToggle.textContent = document.body.classList.contains("light") ? "üåô Dark Mode" : "‚òÄÔ∏è Light Mode";
});

// INIT
(async function main() {
    await autoInvest();
    await updateUI();
})();
</script>

</body>
</html>
