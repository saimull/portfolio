<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Portfolio Tracker</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root {
    --bg: #0d1117;
    --text: #e6edf3;
    --card: #161b22;
    --border: #30363d;
    --accent: #58a6ff;
}

body.light {
    --bg: #f4f7fa;
    --text: #333;
    --card: #ffffff;
    --border: #ddd;
    --accent: #1a73e8;
}

body {
    background: var(--bg);
    color: var(--text);
    margin: 0;
    padding: 0;
    font-family: Arial, sans-serif;
    transition: background 0.3s, color 0.3s;
}

header {
    background: var(--accent);
    color: white;
    padding: 20px;
    text-align: center;
    position: relative;
}

#themeToggle {
    position: absolute;
    top: 20px;
    right: 20px;
    padding: 8px 14px;
    background: #ffffff22;
    border: 1px solid #fff5;
    border-radius: 6px;
    color: white;
    cursor: pointer;
}

.container {
    width: 95%;
    max-width: 1100px;
    margin: 20px auto;
    padding: 0 10px;
}

.card {
    background: var(--card);
    color: var(--text);
    border-radius: 8px;
    padding: 20px;
    margin: 20px 0;
    box-shadow: 0 2px 5px rgba(0,0,0,0.15);
    transition: background 0.3s, color 0.3s;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
    color: var(--text);
    display: block;
    overflow-x: auto;
}

th, td {
    padding: 8px;
    border-bottom: 1px solid var(--border);
    white-space: nowrap;
}

h1 { font-size: 1.6em; }
h2 { font-size: 1.2em; }

.footer {
    text-align: center;
    padding: 20px;
    color: var(--text);
    opacity: 0.7;
}

@media (max-width: 600px) {
    body { font-size: 14px; }
    h1 { font-size: 1.4em; }
    h2 { font-size: 1em; }
    #themeToggle { padding: 6px 10px; top: 15px; right: 15px; font-size: 0.9em; }
}
</style>
</head>

<body class="dark">

<header>
    <h1>Portfolio Tracker</h1>
    <p>Auto-Invest ‚Ä¢ Live Prices ‚Ä¢ KPIs</p>
    <button id="themeToggle">‚òÄÔ∏è Light Mode</button>
</header>

<div class="container">

    <div class="card">
        <h2>üìä Total Portfolio KPIs</h2>
        <p><strong>Total Invested:</strong> $<span id="totalInvested">0</span></p>
        <p><strong>Market Value:</strong> $<span id="marketValue">0</span></p>
        <p><strong>Total P/L:</strong> $<span id="totalPL">0</span> (<span id="totalPLPercent">0</span>%)</p>
    </div>

    <div class="card">
        <h2>üí∞ Crypto Holdings</h2>
        <table id="cryptoTable">
            <tr>
                <th>Asset</th>
                <th>Units</th>
                <th>Avg Cost</th>
                <th>Invested</th>
                <th>Price</th>
                <th>Value</th>
                <th>P/L</th>
            </tr>
        </table>
    </div>

</div>

<div class="footer">¬© 2025 Portfolio Tracker</div>

<script>
// CONFIG
const cryptoIDs = {
    BTC: "bitcoin",
    ETH: "ethereum"
};

const cryptoMonthly = 100;  // total monthly crypto investment
const cryptoAlloc = { BTC: 0.8, ETH: 0.2 };

// STORAGE
let portfolio = JSON.parse(localStorage.getItem("portfolioData")) || {
    crypto: { 
        BTC: { purchases: [] }, 
        ETH: { purchases: [] }
    },
    lastInvestmentDate: null
};

function savePortfolio() { localStorage.setItem("portfolioData", JSON.stringify(portfolio)); }

// AUTO-INVEST
async function autoInvest() {
    let today = new Date();
    let todayStr = today.toISOString().split("T")[0];
    if (portfolio.lastInvestmentDate === null || (today.getDate() === 1 && portfolio.lastInvestmentDate !== todayStr)) {
        await runInvestment();
        portfolio.lastInvestmentDate = todayStr;
        savePortfolio();
    }
}

async function runInvestment() {
    const cryptoPrices = await fetchCryptoPrices();
    const todayStr = new Date().toISOString().split("T")[0];

    for (const sym of Object.keys(cryptoAlloc)) {
        const amount = cryptoMonthly * cryptoAlloc[sym];
        const price = cryptoPrices[sym];
        const units = amount / price;

        portfolio.crypto[sym].purchases.push({
            date: todayStr,
            units: units,
            price: price,
            invested: amount
        });
    }

    savePortfolio();
}

// FETCH PRICES
async function fetchCryptoPrices() {
    const ids = Object.values(cryptoIDs).join(",");
    const res = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=usd`);
    const data = await res.json();
    let prices = {};
    for (const sym of Object.keys(cryptoIDs)) prices[sym] = data[cryptoIDs[sym]].usd;
    return prices;
}

// UPDATE UI
async function updateUI() {
    const cryptoPrices = await fetchCryptoPrices();
    updateCryptoTable(cryptoPrices);
    updatePortfolioKPIs(cryptoPrices);
}

function updateCryptoTable(prices) {
    const table = document.getElementById("cryptoTable");
    table.querySelectorAll("tr:not(:first-child)").forEach(e => e.remove());

    for (const sym of Object.keys(portfolio.crypto)) {
        const purchases = portfolio.crypto[sym].purchases;
        if (purchases.length === 0) continue;

        const totalUnits = purchases.reduce((sum,p)=>sum+p.units,0);
        const totalInvested = purchases.reduce((sum,p)=>sum+p.invested,0);
        const avg = totalInvested / totalUnits;
        const value = totalUnits * prices[sym];
        const pl = value - totalInvested;

        table.innerHTML += `<tr>
            <td>${sym}</td>
            <td>${totalUnits.toFixed(6)}</td>
            <td>$${avg.toFixed(2)}</td>
            <td>$${totalInvested.toFixed(2)}</td>
            <td>$${prices[sym].toFixed(2)}</td>
            <td>$${value.toFixed(2)}</td>
            <td style="color:${pl>=0?"lightgreen":"red"}">$${pl.toFixed(2)}</td>
        </tr>`;
    }
}

function updatePortfolioKPIs(cryptoPrices) {
    let invested = 0, value = 0;

    for (const sym of Object.keys(portfolio.crypto)) {
        const purchases = portfolio.crypto[sym].purchases;
        const totalUnits = purchases.reduce((sum,p)=>sum+p.units,0);
        const totalInvested = purchases.reduce((sum,p)=>sum+p.invested,0);
        invested += totalInvested;
        value += totalUnits * cryptoPrices[sym];
    }

    const pl = value - invested;
    document.getElementById("totalInvested").innerText = invested.toFixed(2);
    document.getElementById("marketValue").innerText = value.toFixed(2);
    document.getElementById("totalPL").innerText = pl.toFixed(2);
    document.getElementById("totalPLPercent").innerText = ((pl/invested)*100).toFixed(2);
}

// DARK MODE
const themeToggle = document.getElementById("themeToggle");
themeToggle.addEventListener("click", () => {
    document.body.classList.toggle("light");
    themeToggle.textContent = document.body.classList.contains("light") ? "üåô Dark Mode" : "‚òÄÔ∏è Light Mode";
});

// INIT
(async function main() {
    await autoInvest();
    await updateUI();
})();
</script>

</body>
</html>
